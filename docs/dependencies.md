# 系统依赖关系与开发顺序

## 系统依赖关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            游戏主场景 (Task 1)                               │
│                     initGamePlayScene → TaskFlow                            │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        ▼                             ▼                             ▼
┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐
│   时间系统         │    │   指标系统         │    │   资源系统         │
│   (Task 4)        │    │   (Task 2)        │    │   (Task 3)        │
│                   │    │                   │    │                   │
│ TimeComponent     │◄───│ IndicatorComponent│◄───│ ResourceComponent │
│ TimeSystem        │    │ IndicatorSystem   │    │ ResourceSystem    │
└─────────┬─────────┘    └─────────┬─────────┘    └─────────┬─────────┘
          │                        │                        │
          │                        │                        │
          ▼                        │                        │
┌───────────────────┐              │                        │
│   事件系统         │              │                        │
│   (Task 10)       │              │                        │
│                   │              │                        │
│ EventSystem       │◄────────────┴────────────────────────┘
│                   │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐
│   人口系统         │    │   建筑系统         │    │   产业系统         │
│   (Task 5)        │    │   (Task 6)        │    │   (Task 7)        │
│                   │    │                   │    │                   │
│ PopulationComp    │    │ BuildingComponent │    │ IndustrySystem    │
│ PopulationSystem  │◄───│ BuildingSystem    │◄───│                   │
└─────────┬─────────┘    └───────────────────┘    └─────────┬─────────┘
          │                                                    │
          │                                                    │
          └────────────────────────┬───────────────────────────┘
                                   │
                                   ▼
┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐
│   任务系统         │    │   政策系统         │    │   结局系统         │
│   (Task 8)        │    │   (Task 9)        │    │   (Task 12)       │
│                   │    │                   │    │                   │
│ MissionSystem     │◄───│ PolicySystem      │    │ EndingSystem      │
│                   │    │                   │◄────┘                 │
└─────────┬─────────┘    └───────────────────┘                      │
          │                                                            │
          │                                                            │
          └────────────────────────┬───────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           UI系统 (Task 11)                              │
│              GameHUD ← IndicatorPanel ← ResourcePanel                  │
└─────────────────────────────────────────────────────────────────────────┘
                                   │
          ┌────────────────────────┼────────────────────────┐
          ▼                        ▼                        ▼
┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐
│  数值平衡          │    │  美术资源          │    │  存档功能          │
│  (Task 13)        │    │  (Task 14)        │    │  (Task 16)        │
│                   │    │                   │    │                   │
│ BalanceConfig     │    │ PixelRenderSystem│    │ SaveManager       │
│                   │    │                   │    │ AutoSaveSystem    │
└───────────────────┘    └───────────────────┘    └───────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          性能优化 (Task 15)                               │
│              PerformanceMonitor ← BatchRenderSystem                     │
└─────────────────────────────────────────────────────────────────────────┘
```

## 依赖矩阵

| 系统 | 依赖 | 被依赖 |
|------|------|--------|
| 时间系统 | 游戏主场景 | 事件系统、任务系统 |
| 指标系统 | 游戏主场景 | 资源系统、人口系统、结局系统 |
| 资源系统 | 指标系统 | 建筑系统、产业系统 |
| 人口系统 | 指标系统、资源系统 | 建筑系统、产业系统 |
| 建筑系统 | 资源系统、人口系统 | 产业系统 |
| 产业系统 | 人口系统、建筑系统 | 任务系统 |
| 任务系统 | 所有核心系统 | 政策系统、UI系统 |
| 政策系统 | 任务系统 | 结局系统 |
| 事件系统 | 时间系统、指标系统 | 结局系统 |
| UI系统 | 所有游戏系统 | - |
| 结局系统 | 政策系统、事件系统、UI系统 | - |

## 推荐开发顺序

### 第一批 (可并行开发)
1. **Task 1**: 游戏主场景框架
2. **Task 2**: 核心指标系统
3. **Task 3**: 基础资源系统
4. **Task 4**: 时间推进系统

### 第二批 (依赖第一批)
5. **Task 5**: 人口管理系统
6. **Task 6**: 建筑系统

### 第三批 (依赖前两批)
7. **Task 7**: 产业发展系统
8. **Task 8**: 任务系统

### 第四批 (依赖第三批)
9. **Task 9**: 政策决策系统
10. **Task 10**: 随机事件系统
11. **Task 11**: 交互UI系统
12. **Task 12**: 结局判定系统

### 第五批 (最终整合)
13. **Task 13**: 数值平衡调整
14. **Task 14**: 像素美术资源
15. **Task 15**: 性能优化
16. **Task 16**: 存档功能

## 验证策略

### 单元测试
- 核心系统逻辑测试
- 组件行为测试

### 集成测试
- 系统间交互测试
- 数据流测试

### 手动验证
- UI交互测试
- 游戏流程测试

### 压力测试
- 长时间运行测试
- 多周目测试

## 里程碑

| 里程碑 | 完成条件 | 预期时间 |
|--------|---------|---------|
| M1: 原型 | Task 1-4 | 第1周 |
| M2: 核心玩法 | Task 5-8 | 第2-3周 |
| M3: 完整系统 | Task 9-12 | 第3-4周 |
| M4: 打磨上线 | Task 13-16 | 第4-5周 |
